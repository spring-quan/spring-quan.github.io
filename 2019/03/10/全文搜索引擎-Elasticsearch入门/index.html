<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>全文搜索引擎-Elasticsearch入门 |</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="spring"><meta name="designer" content="minfive"><meta name="keywords" content="null"><meta name="description" content="游龙当归海，海不迎我自来也。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://yoursite.com/2019/03/10/全文搜索引擎-Elasticsearch入门/index.html"><link rel="icon" type="image/png" href="undefined" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="spring's Blog"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(undefined)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="spring's Blog" alt="spring's Blog"><img src="undefined" alt="spring's Blog"></a><nav class="page__nav"><ul class="nav__list clearfix"></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="undefined" alt="全文搜索引擎-Elasticsearch入门"></div><header class="post__info"><h1 class="post__title">全文搜索引擎-Elasticsearch入门</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">undefined</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-03-10</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/Elasticsearch/">Elasticsearch</a></li></ul></div></div></header><div class="post__content"><p>Elasticsearch是一个开源的搜索引擎框架。</p><a id="more"></a><h2 id="Elasticsearch安装和启动"><a href="#Elasticsearch安装和启动" class="headerlink" title="Elasticsearch安装和启动"></a>Elasticsearch安装和启动</h2><p><strong>安装前提：</strong>Elasticsearch需要Java7或以上的版本。</p><ol><li><p>下载压缩包并解压：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.6.1.zip</span><br><span class="line">unzip elasticsearch-6.6.1.zip</span><br><span class="line">cd elasticsearch-6.6.1</span><br></pre></td></tr></table></figure></li><li><p>进入解压后的文件目录，启动elasticsearch：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch</span><br></pre></td></tr></table></figure></li><li><p>如果一切正常，elasticsearch默认在本机9200端口运行。打开另一个命令行窗口，执行以下命令，检查elasticsearch是否运行成功：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200</span><br></pre></td></tr></table></figure><p>如果输出以下信息，则运行正常。<img src="./images/12.png" alt></p></li><li><p>默认情况下，elasticsearch只允许本机访问。要想其他电脑可以访问，也就是实现远程访问，需要修改文件<code>/config/elasticsearch.yml</code>,取消字段<code>network.host</code>的注释，把该字段的值改为<code>0.0.0.0</code>。这样的话所有的电脑都能访问，实际情况中，最好不要这样。</p></li><li><p>如果启动遇到错误“Native controller process has stopped - no new native processes can be started”或“max virtual memory areas vm.maxmapcount [65530] is too low”。解决方法是执行以下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure></li></ol><h2 id="在python中使用elasticsearch"><a href="#在python中使用elasticsearch" class="headerlink" title="在python中使用elasticsearch"></a>在python中使用elasticsearch</h2><p>要先安装elasticsearch包。在python中使用elasticsearch要先启动elasticsearch。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch</span><br></pre></td></tr></table></figure><h3 id="创建index"><a href="#创建index" class="headerlink" title="创建index"></a>创建index</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from elasticsearch import Elasticsearch </span><br><span class="line">es = Elasticsearch() #创建实例，默认localhost:9200</span><br><span class="line"># es = Elasticsearch([&#123;&apos;host&apos;:&apos;10.112.1.109&apos;,&apos;port&apos;:&apos;9200&apos;&#125;]) #远程访问</span><br><span class="line">result = es.indices.create(index = &apos;news&apos;,ignore = 400)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>如果创建成功，会返回以下信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&apos;acknowledged&apos;: True, &apos;shards_acknowledged&apos;: True, &apos;index&apos;: &apos;test_es&apos;&#125;</span><br></pre></td></tr></table></figure><p>如果再次创建，就会返回以下信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&apos;error&apos;: &#123;&apos;root_cause&apos;: [&#123;&apos;type&apos;: &apos;resource_already_exists_exception&apos;, &apos;reason&apos;: &apos;index [news/TrkzNdXZRi6ReiZqOM2Dvg] already exists&apos;, &apos;index_uuid&apos;: &apos;TrkzNdXZRi6ReiZqOM2Dvg&apos;, &apos;index&apos;: &apos;news&apos;&#125;], &apos;type&apos;: &apos;resource_already_exists_exception&apos;, &apos;reason&apos;: &apos;index [news/TrkzNdXZRi6ReiZqOM2Dvg] already exists&apos;, &apos;index_uuid&apos;: &apos;TrkzNdXZRi6ReiZqOM2Dvg&apos;, &apos;index&apos;: &apos;news&apos;&#125;, &apos;status&apos;: 400&#125;</span><br></pre></td></tr></table></figure><p>表示创建失败，失败的原因是要创建的index已经存在了。status状态码是400。</p><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">datas = [</span><br><span class="line">    &#123;&apos;title&apos;:&quot;算法导论（原书第2版）&quot;,</span><br><span class="line">    &apos;url&apos;:&quot;https://book.douban.com/subject/1885170/&quot;,</span><br><span class="line">    &apos;introduction&apos;:&quot;这本书深入浅出，全面地介绍了计算机算法。对每一个算法的分析既易于理解又十分有趣，并保持了数学严谨性。本书的设计目标全面，适用于多种用途。涵盖的内容有：算法在计算中的作用，概率分析和随机算法的介绍。书中专门讨论了线性规划，介绍了动态规划的两个应用，随机化和线性规划技术的近似算法等，还有有关递归求解、快速排序中用到的划分方法与期望线性时间顺序统计算法，以及对贪心算法元素的讨论。此书还介绍了对强连通子图算法正确性的证明，对哈密顿回路和子集求和问题的NP完全性的证明等内容。全书提供了900多个练习题和思考题以及叙述较为详细的实例研究。这本书深入浅出，全面地介绍了计算机算法。对每一个算法的分析既易于理解又十分有趣，并保持了数学严谨性。本书的设计目标全面，适用于多种用途。涵盖的内容有：算法在计算中的作用，概率分析和随机算法的介绍。书中专门讨论了线性规划，介绍了动态规划的两个应用，随机化和线性规划技术的近似算法等，还有有关递归求解、快速排序中用到的划分方法与期望线性时间顺序统计算法，以及对贪心算法元素的讨论。此书还介绍了对强连通子图算法正确性的证明，对哈密顿回路和子集求和问题的NP完全性的证明等内容。全书提供了900多个练习题和思考题以及叙述较为详细的实例研究。&quot;&#125;,</span><br><span class="line">    &#123;&apos;title&apos;:&quot;计算机程序的构造和解释&quot;,</span><br><span class="line">    &apos;url&apos;:&quot;https://book.douban.com/subject/1148282/&quot;,</span><br><span class="line">    &apos;introduction&apos;:&quot;《计算机程序的构造和解释(原书第2版)》1984年出版，成型于美国麻省理工学院(MIT)多年使用的一本教材，1996年修订为第2版。在过去的二十多年里，《计算机程序的构造和解释(原书第2版)》对于计算机科学的教育计划产生了深刻的影响。第2版中大部分重要程序设计系统都重新修改并做过测试，包括各种解释器和编译器。作者根据其后十余年的教学实践，还对其他许多细节做了相应的修改。&quot;&#125;,</span><br><span class="line">    </span><br><span class="line">]</span><br><span class="line">for i in range(len(datas)):</span><br><span class="line">    es.index(index = &apos;book&apos;,doc_type = &apos;computer&apos;,id = i+1,body = datas[i])</span><br></pre></td></tr></table></figure><p>index()方法可以完成两个操作，如果数据不存在，那就插入数据；如果数据已经存在，那就更新数据。</p><h3 id="get-按ID查询"><a href="#get-按ID查询" class="headerlink" title="get()按ID查询"></a>get()按ID查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result= es.get(index=&apos;book&apos;,doc_type=&apos;computer&apos;,id =1)</span><br><span class="line">print(result[&apos;_source&apos;])</span><br></pre></td></tr></table></figure><h3 id="search-实现全文检索"><a href="#search-实现全文检索" class="headerlink" title="search()实现全文检索"></a>search()实现全文检索</h3><p>对于中文，我们要安装一个中文分词插件<a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">elasticsearch-analysis-ik</a>。可以使用elastic的另一个命令行工具elastisearch-plugin来安装，要确保版本号一致。进入elastic的目录下，执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.3.0/elasticsearch-analysis-ik-6.3.0.zip</span><br></pre></td></tr></table></figure><p>注意将<code>6.3.0</code>替换为自己的版本号。安装成功后，重启elasticsearch，就会自动加载这个中文分词插件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">es = Elasticsearch()</span><br><span class="line">mapping = &#123;</span><br><span class="line">    &apos;properties&apos;: &#123;</span><br><span class="line">        &apos;title&apos;: &#123;</span><br><span class="line">            &apos;type&apos;: &apos;text&apos;,</span><br><span class="line">            &apos;analyzer&apos;: &apos;ik_max_word&apos;,</span><br><span class="line">            &apos;search_analyzer&apos;: &apos;ik_max_word&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">result = es.indices.put_mapping(index=&apos;news&apos;, doc_type=&apos;politics&apos;, body=mapping)</span><br></pre></td></tr></table></figure><p>指定使用中文分词器，如果不指定默认使用英文分词器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dsl = &#123;</span><br><span class="line">    &apos;query&apos;: &#123;</span><br><span class="line">        &apos;match&apos;: &#123;</span><br><span class="line">            &apos;introduction&apos;: &apos;计算机&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">result = es.search(index=&apos;news&apos;, doc_type=&apos;politics&apos;, body=dsl)</span><br></pre></td></tr></table></figure><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul><li><a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" target="_blank" rel="noopener">全文搜索引擎 Elasticsearch 入门教程—–阮一峰</a></li><li><a href="https://elasticsearch-py.readthedocs.io/en/master/" target="_blank" rel="noopener">Python Elasticsearch文档</a></li><li><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/running-elasticsearch.html" target="_blank" rel="noopener">Elasticsearch官方文档</a></li><li><a href="https://cuiqingcai.com/6214.html" target="_blank" rel="noopener">Elasticsearch基本介绍及其与Python的对接实现–崔庆才</a></li><li><a href="https://www.jianshu.com/p/914f102bc174" target="_blank" rel="noopener">Elasticsearch搜索中文分词优化</a></li></ul><div class="post-announce">Thank you for reading, this article belongs to <a href="http://yoursite.com">spring's Blog</a> copyright, if reproduced, please indicate the source：spring's Blog（<a href="http://yoursite.com/2019/03/10/全文搜索引擎-Elasticsearch入门/">http://yoursite.com/2019/03/10/全文搜索引擎-Elasticsearch入门/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2019/03/07/Ubuntu服务器遇到的一些问题/" title="Ubuntu服务器遇到的一些问题"><i class="iconfont icon-prev"></i>Ubuntu服务器遇到的一些问题</a></div><div class="post__prev post__prev--right"><a href="/2019/03/10/python的一些函数/" title="python的一些函数">python的一些函数<i class="iconfont icon-next"></i></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">Introduction</h3><p class="block__text">游龙当归海，海不迎我自来也。</p></div><div class="sidebar__block"><h3 class="block__title">Categories</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/论文/">论文</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/生活记录/">生活记录</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/机器学习/">机器学习</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/技术资料/">技术资料</a><span class="block-list-count">4</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/年度总结/">年度总结</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/学习笔记/">学习笔记</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/web搜索/">web搜索</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/pytorch/">pytorch</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/python/">python</a><span class="block-list-count">2</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">Latest Post</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/07/12/pip安装python模块报错/" title="pip安装python模块报错"><div class="item__cover"><img src="undefined" alt="pip安装python模块报错"></div><div class="item__info"><h3 class="item__title">pip安装python模块报错</h3><span class="item__text">2019-07-12</span></div></a></li><li class="latest-post-item"><a href="/2019/07/10/NAACL2019-对话系统/" title="NAACL2019-对话系统"><div class="item__cover"><img src="undefined" alt="NAACL2019-对话系统"></div><div class="item__info"><h3 class="item__title">NAACL2019-对话系统</h3><span class="item__text">2019-07-10</span></div></a></li><li class="latest-post-item"><a href="/2019/07/07/ACL2019-对话系统/" title="ACL2019-对话系统"><div class="item__cover"><img src="undefined" alt="ACL2019-对话系统"></div><div class="item__info"><h3 class="item__title">ACL2019-对话系统</h3><span class="item__text">2019-07-07</span></div></a></li><li class="latest-post-item"><a href="/2019/04/24/自然语言处理-会议列表/" title="自然语言处理---会议列表"><div class="item__cover"><img src="undefined" alt="自然语言处理---会议列表"></div><div class="item__info"><h3 class="item__title">自然语言处理---会议列表</h3><span class="item__text">2019-04-24</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">Tags</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/ACL2019/">ACL2019</a></li><li class="tag-item"><a class="tag-link" href="/tags/Elasticsearch/">Elasticsearch</a></li><li class="tag-item"><a class="tag-link" href="/tags/GPU/">GPU</a></li><li class="tag-item"><a class="tag-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-item"><a class="tag-link" href="/tags/LSTM/">LSTM</a></li><li class="tag-item"><a class="tag-link" href="/tags/Linux/">Linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/Numpy/">Numpy</a></li><li class="tag-item"><a class="tag-link" href="/tags/csv/">csv</a></li><li class="tag-item"><a class="tag-link" href="/tags/cuda/">cuda</a></li><li class="tag-item"><a class="tag-link" href="/tags/dialog-system/">dialog system</a></li><li class="tag-item"><a class="tag-link" href="/tags/linux/">linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/nvidia-smi/">nvidia-smi</a></li><li class="tag-item"><a class="tag-link" href="/tags/panda/">panda</a></li><li class="tag-item"><a class="tag-link" href="/tags/python/">python</a></li><li class="tag-item"><a class="tag-link" href="/tags/pytorch/">pytorch</a></li><li class="tag-item"><a class="tag-link" href="/tags/sublime/">sublime</a></li><li class="tag-item"><a class="tag-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-item"><a class="tag-link" href="/tags/word-embedding/">word embedding</a></li><li class="tag-item"><a class="tag-link" href="/tags/交叉熵/">交叉熵</a></li><li class="tag-item"><a class="tag-link" href="/tags/会议列表/">会议列表</a></li><li class="tag-item"><a class="tag-link" href="/tags/前向后向算法/">前向后向算法</a></li><li class="tag-item"><a class="tag-link" href="/tags/年度总结/">年度总结</a></li><li class="tag-item"><a class="tag-link" href="/tags/循环神经网络/">循环神经网络</a></li><li class="tag-item"><a class="tag-link" href="/tags/搭建博客/">搭建博客</a></li><li class="tag-item"><a class="tag-link" href="/tags/新藏线/">新藏线</a></li><li class="tag-item"><a class="tag-link" href="/tags/服务器/">服务器</a></li><li class="tag-item"><a class="tag-link" href="/tags/条件随机场/">条件随机场</a></li><li class="tag-item"><a class="tag-link" href="/tags/生活记录/">生活记录</a></li><li class="tag-item"><a class="tag-link" href="/tags/相对熵/">相对熵</a></li><li class="tag-item"><a class="tag-link" href="/tags/维特比算法/">维特比算法</a></li><li class="tag-item"><a class="tag-link" href="/tags/骑车/">骑车</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">About</h3><div class="item__content"><p class="item__text"></p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span></span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span></span></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>